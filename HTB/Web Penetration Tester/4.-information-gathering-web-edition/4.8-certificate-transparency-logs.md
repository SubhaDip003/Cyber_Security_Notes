---
layout:
  width: wide
  title:
    visible: true
  description:
    visible: false
  tableOfContents:
    visible: true
  outline:
    visible: true
  pagination:
    visible: true
  metadata:
    visible: false
---

# 4.8 Certificate Transparency Logs

### What are Certificate Transparency Logs?

`Certificate Transparency` (`CT`) logs are public, append-only ledgers that record the issuance of SSL/TLS certificates. Whenever a Certificate Authority (CA) issues a new certificate, it must submit it to multiple CT logs. Independent organisations maintain these logs and are open for anyone to inspect.

Think of CT logs as a `global registry of certificates`. They provide a transparent and verifiable record of every SSL/TLS certificate issued for a website.

**Certificate Transparency (CT) logs** are a public system that helps keep SSL/TLS certificates honest and trustworthy.

1. When a website requests a certificate, the Certificate Authority (CA) first creates a temporary version of it called a **pre-certificate**. This pre-certificate is then sent to multiple public CT logs. These logs are **append-only**, which means once something is added, it can never be changed or removed. This prevents certificates from being secretly issued and hidden.
2. After receiving the pre-certificate, each CT log generates a **Signed Certificate Timestamp (SCT)**. An SCT is proof that the certificate was logged at a specific time. These SCTs are included in the final certificate given to the website.
3. When a user visits a website, the browser checks the certificate’s SCTs against the public CT logs. If the certificate is properly logged, the connection is allowed. If not, the browser may warn the user.
4. CT logs are constantly monitored by security researchers, companies, and browser vendors. If a suspicious or unauthorized certificate appears, it can be detected and reported quickly, helping prevent misuse.

#### The Merkle Tree Structure

A **Merkle Tree** is a secure way to organize and protect data, and CT logs use it to make sure certificates cannot be changed secretly.

In this structure, **each certificate is turned into a hash** and placed at the bottom of the tree (leaf nodes). These hashes are then combined in pairs and hashed again, forming upper-level nodes. This process continues until only **one final hash** remains at the top, called the **Merkle root**, which represents the entire log.

<figure><img src="../.gitbook/assets/image (1).png" alt=""><figcaption></figcaption></figure>

To check whether a certificate is really in the CT log, you don’t need the whole log. You only need the certificate’s hash and a few related hashes (called the **Merkle path**) that lead up to the root. If all the hashes match correctly, the certificate is confirmed as valid and logged.

If even **one small part of a certificate changes**, its hash changes, which also changes the Merkle root. This instantly reveals tampering. Because of this, Merkle trees make CT logs **tamper-proof, efficient to verify, and highly trustworthy**, helping keep SSL/TLS certificates secure.

### CT Logs and Web Recon

Certificate Transparency (CT) logs offer a treasure trove of subdomain information for passive reconnaissance. These publicly accessible logs record SSL/TLS certificates issued for domains and their subdomains, serving as a security measure to prevent fraudulent certificates. For reconnaissance, they offer a window into potentially overlooked subdomains.

### Searching CT Logs

There are two popular options for searching CT logs:

| Tool                                | Key Features                                                                                                     | Use Cases                                                                                                 | Pros                                              | Cons                                         |
| ----------------------------------- | ---------------------------------------------------------------------------------------------------------------- | --------------------------------------------------------------------------------------------------------- | ------------------------------------------------- | -------------------------------------------- |
| [crt.sh](https://crt.sh/)           | User-friendly web interface, simple search by domain, displays certificate details, SAN entries.                 | Quick and easy searches, identifying subdomains, checking certificate issuance history.                   | Free, easy to use, no registration required.      | Limited filtering and analysis options.      |
| [Censys](https://search.censys.io/) | Powerful search engine for internet-connected devices, advanced filtering by domain, IP, certificate attributes. | In-depth analysis of certificates, identifying misconfigurations, finding related certificates and hosts. | Extensive data and filtering options, API access. | Requires registration (free tier available). |

#### crt.sh lookup

The `crt.sh` website provides a searchable interface for CT logs. To efficiently extract subdomains using `crt.sh` within your terminal, you can use a command like this:

```bash
SubhaDip03@htb[/htb]$ curl -s "https://crt.sh/?q=facebook.com&output=json" | jq -r '.[]
 | select(.name_value | contains("dev")) | .name_value' | sort -u
 
*.dev.facebook.com
*.newdev.facebook.com
*.secure.dev.facebook.com
dev.facebook.com
devvm1958.ftw3.facebook.com
facebook-amex-dev.facebook.com
facebook-amex-sign-enc-dev.facebook.com
newdev.facebook.com
secure.dev.facebook.com
```

* `curl -s "https://crt.sh/?q=facebook.com&output=json"`: This command fetches the JSON output from crt.sh for certificates matching the domain `facebook.com`.
* `jq -r '.[] | select(.name_value | contains("dev")) | .name_value'`: This part filters the JSON results, selecting only entries where the `name_value` field (which contains the domain or subdomain) includes the string "`dev`". The `-r` flag tells `jq` to output raw strings.
* `sort -u`: This sorts the results alphabetically and removes duplicates.
