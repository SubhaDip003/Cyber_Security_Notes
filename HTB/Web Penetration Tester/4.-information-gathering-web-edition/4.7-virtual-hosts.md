---
layout:
  width: wide
  title:
    visible: true
  description:
    visible: false
  tableOfContents:
    visible: true
  outline:
    visible: true
  pagination:
    visible: true
  metadata:
    visible: false
---

# 4.7 Virtual Hosts

Virtual hosting is a technique that allows multiple websites to share a single IP address. Each website is associated with a unique hostname, which is used to direct incoming requests to the correct site. This can be a cost-effective way for organizations to host multiple websites on a single server, but it can also create a challenge for web reconnaissance.

Since multiple websites share the same IP address, simply scanning the IP won't reveal all the hosted sites. You need a tool that can test different hostnames against the IP address to see which ones respond.

### Understanding VHosts and Subdomains

Virtual hosting allows a single server (one IP address) to host **multiple websites or applications**. The web server decides which site to show by reading the **Host header** in the HTTP request. This header tells the server which domain name the user is trying to access, and the server responds with the matching website configuration.

#### **Subdomain:**

A subdomain is a **part of a main domain name** and is created using DNS.\
For example, `blog.example.com` is a subdomain of `example.com`.\
Each subdomain usually has its own DNS record that points to an IP address. Subdomains are commonly used to separate services or sections of a site, such as blogs, APIs, admin panels, or login portals.

**Example:**

* `example.com` → Main website
* `blog.example.com` → Blog section
* `api.example.com` → API service

#### **VHOST (Virtual Host):**

A virtual host is a **web server configuration**, not a DNS entry. It tells the server how to handle requests for a specific domain or subdomain. Multiple virtual hosts can exist on the same server and IP address, each serving different content or applications.

**Example:**\
On one server and one IP:

* `example.com` → Company website
* `dev.example.com` → Development version
* `admin.example.com` → Admin panel

All of these are controlled by **separate VHost configurations** on the server.

#### **Hosts File & No DNS Record:**

Even if a virtual host does not exist in DNS, you can still access it by adding an entry to your local **hosts file**. This file manually maps a domain name to an IP address, skipping DNS completely. This is often used in testing and penetration testing.

**Example:**\
If the server IP is `192.168.1.10`, adding this to your hosts file:

```
192.168.1.10 dev.example.com
```

lets you access `dev.example.com` in your browser, even if it doesn’t exist in public DNS.

**In short:**

* **Subdomain** = DNS-level name
* **VHOST** = Server-level configuration
* **Hosts file** = Local override to access hidden or internal VHosts

Virtual hosts can also be configured to use different domains, not just subdomains. For example:

```html
# Example of name-based virtual host configuration in Apache
<VirtualHost *:80>
    ServerName www.example1.com
    DocumentRoot /var/www/example1
</VirtualHost>

<VirtualHost *:80>
    ServerName www.example2.org
    DocumentRoot /var/www/example2
</VirtualHost>

<VirtualHost *:80>
    ServerName www.another-example.net
    DocumentRoot /var/www/another-example
</VirtualHost>
```

Here, `example1.com`, `example2.org`, and `another-example.net` are distinct domains hosted on the same server. The web server uses the `Host` header to serve the appropriate content based on the requested domain name.

### Server VHost Lookup

The following illustrates the process of how a web server determines the correct content to serve based on the `Host` header:

![Sequence diagram showing interactions between Browser, WebServer, VirtualHostConfig, and DocumentRoot. Includes HTTP request, server response, and file access steps.](https://cdn.services-k8s.prod.aws.htb.systems/content/modules/144/ig_virtualhosts_1.png)

1. **Browser Requests a Website:** When you enter a domain name (e.g., `www.inlanefreight.com`) into your browser, it initiates an HTTP request to the web server associated with that domain's IP address.
2. **Host Header Reveals the Domain:** The browser includes the domain name in the request's `Host` header, which acts as a label to inform the web server which website is being requested.
3. `Web Server Determines the Virtual Host`: The web server receives the request, examines the `Host` header, and consults its virtual host configuration to find a matching entry for the requested domain name.
4. **Serving the Right Content:** Upon identifying the correct virtual host configuration, the web server retrieves the corresponding files and resources associated with that website from its document root and sends them back to the browser as the HTTP response.

In essence, the `Host` header functions as a switch, enabling the web server to dynamically determine which website to serve based on the domain name requested by the browser.

#### Types of Virtual Hosting

**Name-Based Virtual Hosting**\
The server decides which website to show based on the **Host header** in the request. Multiple websites share the same IP address. This is the most common method because it is cheap, easy to manage, and works well for most websites.

**IP-Based Virtual Hosting**\
Each website gets its **own IP address**. The server identifies the website using the IP, not the Host header. It provides better separation between websites but needs more IP addresses, which makes it less scalable and more expensive.

**Port-Based Virtual Hosting**\
Different websites run on **different ports** of the same IP address (like `:80`, `:8080`). It saves IP addresses but is less user-friendly because users must include the port number in the URL.

Several tools are available to aid in the discovery of virtual hosts:

| Tool                                                 | Description                                                                                                      | Features                                                        |
| ---------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------- | --------------------------------------------------------------- |
| [gobuster](https://github.com/OJ/gobuster)           | A multi-purpose tool often used for directory/file brute-forcing, but also effective for virtual host discovery. | Fast, supports multiple HTTP methods, can use custom wordlists. |
| [Feroxbuster](https://github.com/epi052/feroxbuster) | Similar to Gobuster, but with a Rust-based implementation, known for its speed and flexibility.                  | Supports recursion, wildcard discovery, and various filters.    |
| [ffuf](https://github.com/ffuf/ffuf)                 | Another fast web fuzzer that can be used for virtual host discovery by fuzzing the `Host` header.                | Customizable wordlist input and filtering options.              |

#### gobuster

Gobuster is a versatile tool commonly used for directory and file brute-forcing, but it also excels at virtual host discovery. It systematically sends HTTP requests with different `Host` headers to a target IP address and then analyses the responses to identify valid virtual hosts.

The `gobuster` command to bruteforce vhosts generally looks like this:

```bash
gobuster vhost -u http://<target_IP_address> -w <wordlist_file> --append-domain
```

```bash
gobuster vhost -u http://inlanefreight.htb:81 -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-110000.txt --append-domain
===============================================================
Gobuster v3.6
by OJ Reeves (@TheColonial) & Christian Mehlmauer (@firefart)
===============================================================
[+] Url:             http://inlanefreight.htb:81
[+] Method:          GET
[+] Threads:         10
[+] Wordlist:        /usr/share/seclists/Discovery/DNS/subdomains-top1million-110000.txt
[+] User Agent:      gobuster/3.6
[+] Timeout:         10s
[+] Append Domain:   true
===============================================================
Starting gobuster in VHOST enumeration mode
===============================================================
Found: forum.inlanefreight.htb:81 Status: 200 [Size: 100]
[...]
Progress: 114441 / 114442 (100.00%)
===============================================================
Finished
===============================================================
```

> Virtual host discovery can generate significant traffic and might be detected by intrusion detection systems (IDS) or web application firewalls (WAF). Exercise caution and obtain proper authorization before scanning any targets.
